<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Ruleta</title>
  <style>
    :root{
      --size: min(85vw, 85vh, 580px);
      --bg: #0b1022;
      --panel: rgba(255,255,255,0.04);
      --stroke: rgba(255,255,255,0.12);
      --text: #e9eefb;
      --accent: #f8d34c;
      --pointer: #f8d34c;
      --peg: #f8fafc;
      --mobile-breakpoint: 768px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:center;
      background-image: url("Verano2.png");
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      color:var(--text);
      font-family: "Segoe UI", system-ui, -apple-system, sans-serif;
      padding: 60px 12px 20px;
      overflow-x: hidden;
    }
    .wrap{
      width: 100%;
      max-width: 1100px;
      display:grid;
      gap:12px;
      padding: 0 12px;
      margin: 0 auto;
    }
    .topbar{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom: 10px;
    }
    
    @media (max-width: 767px) {
      .topbar {
        flex-direction: column;
        text-align: center;
      }
      
      .brand {
        margin-bottom: 10px;
      }
      
      .actions {
        flex-direction: column;
        align-items: center;
        width: 100%;
      }
      
      button {
        width: 100%;
        max-width: 280px;
      }
      
      .result {
        font-size: 16px;
        padding: 10px 12px;
      }
    }
    
    @media (max-height: 500px) and (orientation: landscape) {
      :root {
        --size: 60vh;
      }
      
      body {
        padding: 60px 12px 10px;
      }
      
      .layout {
        grid-template-columns: 1fr;
        gap: 10px;
      }
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight:800;
      letter-spacing:0.2px;
      font-size:18px;
    }
    .brand .dot{
      width:12px; height:12px; border-radius:50%;
      background:linear-gradient(140deg, #f97316, #22d3ee);
      box-shadow:0 0 0 6px rgba(255,255,255,0.06);
    }
    .topActions{ display:flex; gap:8px; flex-wrap:wrap; }
    button{
      border:0;
      border-radius:12px;
      padding:12px 14px;
      font-weight:800;
      cursor:pointer;
      background:#e90303;
      color:white;
      transition:transform .12s ease, opacity .2s ease, box-shadow .12s ease;
      box-shadow:0 12px 28px rgba(0,0,0,0.25);
    }
    button:hover{ transform:translateY(-1px); }
    button:active{ transform:translateY(0); }
    button:disabled{ opacity:.55; cursor:not-allowed; transform:none; box-shadow:none; }
    .ghost{
      background:rgba(255,255,255,0.06);
      color:var(--text);
      border:1px solid var(--stroke);
      box-shadow:none;
    }
    .card{
      background: rgba(10,14,30,0.25);
      border:1px solid rgba(255,255,255,0.15);
      border-radius:18px;
      padding:16px;
      box-shadow:0 26px 90px rgba(0,0,0,0.15);
      backdrop-filter: blur(12px);
      align-items:center;
    }
    .layout{
      gap:16px;
      grid-template-columns:1fr;
      align-items:center;
      background: rgba(255,255,255,0.05);
      border-radius:12px;
      backdrop-filter: blur(8px);
      padding:8px;
    }
    @media (min-width: 920px){
      .layout{
        grid-template-columns: var(--size) 1fr;
      }
    }
    .wheelArea{
      display:grid;
      place-items:center;
      gap:14px;
    }
    .wheelBox{
      width: var(--size);
      height: var(--size);
      position: relative;
      display: grid;
      place-items: center;
      isolation: isolate;
      margin: 0 auto;
    }
    canvas{
      width:100%;
      height:100%;
      border-radius:50%;
      background:radial-gradient(circle at 50% 50%, rgba(255,255,255,0.02), transparent 55%);
    }
    .ring{
      position:absolute; inset:-12px;
      border:10px solid rgba(255,255,255,0.08);
      border-radius:50%;
      pointer-events:none;
    }
    .hub{
      position:absolute;
      width: 70px;
      height: 70px;
      border-radius:50%;
      background:rgba(255,255,255,0.08);
      border:1px solid rgba(255,255,255,0.16);
      display:grid; place-items:center;
      font-weight:900;
      letter-spacing:0.4px;
      backdrop-filter: blur(10px);
      box-shadow:0 12px 24px rgba(0,0,0,0.35);
      pointer-events:auto;
    }
    .hub button{
      width: 56px;
      height: 56px;
      border-radius:50%;
      font-size:12px;
      padding:0;
      background:#EA1F27;
      border:2px solid rgba(255,255,255,0.3);
      box-shadow:0 8px 20px rgba(0,0,0,0.3);
      transition:transform .15s ease, box-shadow .15s ease;
    }
    .hub button:hover{
      transform:scale(1.05);
      box-shadow:0 10px 25px rgba(0,0,0,0.4);
    }
    .hub button:active{
      transform:scale(0.95);
    }
    .pointerWrap{
      position:absolute;
      top:-20px; left:50%;
      transform: translateX(-50%) rotate(0deg);
      width:90px; height:90px;
      z-index:6;
      pointer-events:none;
      transform-origin: 50% 22px;
    }
    .pointerCap{
      position:absolute;
      left:50%; top:0;
      transform: translateX(-50%);
      width:26px; height:26px;
      border-radius:50%;
      background: rgba(255,255,255,0.95);
      border: 2px solid rgba(0,0,0,0.2);
      box-shadow: 0 10px 18px rgba(0,0,0,0.35);
    }
    .pointer{
      position:absolute;
      left:50%;
      top:18px;
      transform: translateX(-50%);
      width:0; height:0;
      border-left:20px solid transparent;
      border-right:20px solid transparent;
      border-top:36px solid var(--pointer);
      filter: drop-shadow(0 12px 16px rgba(0,0,0,0.55));
    }
    .actions{
      display:flex; gap:10px; flex-wrap:wrap;
      justify-content:center;
    }
    .result{
      font-size:18px; font-weight:900;
      padding:12px 14px;
      border-radius:12px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,0.05);
      text-align:center;
      width:min(520px, 100%);
      box-shadow:0 12px 24px rgba(0,0,0,0.18);
    }
    .help{
      background:var(--panel);
      border:1px solid var(--stroke);
      border-radius:14px;
      padding:14px;
      display:grid;
      gap:8px;
      font-size:14px;
      line-height:1.5;
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      background:rgba(255,255,255,0.05);
      border:1px solid var(--stroke);
      padding:8px 12px;
      border-radius:999px;
      font-size:13px;
    }
    /* Drawer */
    .drawerOverlay{
      position:fixed; inset:0;
      background: rgba(0,0,0,0.55);
      opacity:0; pointer-events:none;
      transition: opacity .2s ease;
      z-index:20;
    }
    .drawer{
      position:fixed;
      top:0; right:0;
      height:100%;
      width:min(420px, 92vw);
      background: rgba(12,18,33,0.96);
      border-left: 1px solid var(--stroke);
      transform: translateX(100%);
      transition: transform .24s ease;
      z-index:30;
      display:flex; flex-direction:column;
      backdrop-filter: blur(12px);
      box-shadow:-18px 0 40px rgba(0,0,0,0.35);
    }
    .drawerHeader, .drawerFooter{
      padding:14px;
      border-bottom:1px solid var(--stroke);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .drawerFooter{ border-top:1px solid var(--stroke); border-bottom:0; justify-content:flex-end; }
    .drawerHeader h3{ margin:0; font-size:16px; letter-spacing:0.2px; }
    .drawerBody{ padding:14px; display:grid; gap:14px; overflow:auto; }
    .field{ display:grid; gap:6px; }
    .row{ display:flex; gap:10px; flex-wrap:wrap; }
    label{ font-size:12px; opacity:.9; letter-spacing:0.2px; }
    textarea, input[type="number"], input[type="range"]{
      width:100%;
      background: rgba(255,255,255,0.06);
      color: var(--text);
      border:1px solid var(--stroke);
      border-radius:12px;
      padding:10px 10px;
      font-size:14px;
      outline:none;
      font-family:inherit;
    }
    textarea{ min-height:180px; resize:vertical; line-height:1.4; }
    .toggle{
      display:flex; align-items:center; gap:10px;
      padding:10px 12px;
      border:1px solid var(--stroke);
      border-radius:12px;
      background: rgba(255,255,255,0.05);
      flex:1;
      min-width:180px;
    }
    .toggle input{ transform: scale(1.25); }
    .tiny{ font-size:12px; opacity:.78; }
    .open .drawerOverlay{ opacity:1; pointer-events:auto; }
    .open .drawer{ transform: translateX(0); }
    .logo-overlay{
      position: fixed;
      top: 20px;
      left: 20px;
      width: 400px;
      height: auto;
      z-index: 100;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <img src="Logo.png" class="logo-overlay" alt="Logo" style="position: fixed; top: 16px; left: 16px; height: 40px; z-index: 1000; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));">
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <span class="dot"></span>
      </div>
      <div class="topActions">
        <button id="shufflePaletteBtn" class="ghost">Mezclar colores</button>
        <button id="settingsBtn">⚙️ Configuración</button>
      </div>
    </div>

    <div class="card layout">
      <div class="wheelArea">
        <div class="wheelBox">
          <div id="pointerWrap" class="pointerWrap">
            <div class="pointerCap"></div>
            <div class="pointer"></div>
          </div>
          <canvas id="wheel" width="900" height="900"></canvas>
          <div class="ring"></div>
          <div class="hub">
            <button id="spinBtn">Girar</button>
          </div>
        </div>

        <div id="result" class="result">Resultado: —</div>
      </div>
    </div>
  </div>

  <!-- Drawer -->
  <div id="drawerRoot">
    <div id="overlay" class="drawerOverlay"></div>
    <aside class="drawer" role="dialog" aria-modal="true">
      <div class="drawerHeader">
        <h3>Configuración</h3>
        <button id="closeDrawerBtn" class="ghost">Cerrar</button>
      </div>

      <div class="drawerBody">
        <div class="field">
          <label>Opciones (una por línea)</label>
          <textarea id="itemsBox"></textarea>
        </div>

        <div class="row">
          <div class="toggle">
            <input id="tickEnabled" type="checkbox" checked>
            <div>
              <div style="font-weight:800;">Sonido tic</div>
              <div class="tiny">Suena al cruzar cada segmento</div>
            </div>
          </div>

          <div class="toggle">
            <input id="dotsEnabled" type="checkbox" checked>
            <div>
              <div style="font-weight:800;">Pelotitas divisoras</div>
              <div class="tiny">Puntos entre secciones</div>
            </div>
          </div>
        </div>

        <div class="field">
          <label>Volumen (tic)</label>
          <input id="tickVolume" type="range" min="0" max="1" step="0.01">
          <div class="tiny" id="tickVolumeLabel"></div>
        </div>

        <div class="row">
          <div class="field" style="flex:1; min-width:160px;">
            <label>Duración del giro (ms)</label>
            <input id="spinDuration" type="number" min="1200" max="15000" step="100">
          </div>
          <div class="field" style="flex:1; min-width:160px;">
            <label>Vueltas base</label>
            <input id="baseTurns" type="number" min="2" max="30" step="1">
          </div>
        </div>

        <div class="field">
          <label>Intensidad wobble</label>
          <input id="wobble" type="range" min="0" max="1" step="0.01">
          <div class="tiny" id="wobbleLabel"></div>
        </div>

        <div class="row">
          <button id="applyBtn">Aplicar</button>
          <button id="closeDrawerBtn2" class="ghost">Cerrar</button>
        </div>
      </div>
    </aside>
  </div>

  <script>
    // =======================
    // Estado y elementos
    // =======================
    const canvas = document.getElementById('wheel');
    const ctx = canvas.getContext('2d');
    const spinBtn = document.getElementById('spinBtn');
    const resultEl = document.getElementById('result');

    const settingsBtn = document.getElementById('settingsBtn');
    const overlay = document.getElementById('overlay');
    const closeDrawerBtn = document.getElementById('closeDrawerBtn');
    const closeDrawerBtn2 = document.getElementById('closeDrawerBtn2');
    const applyBtn = document.getElementById('applyBtn');
    const shufflePaletteBtn = document.getElementById('shufflePaletteBtn');

    const itemsBox = document.getElementById('itemsBox');
    const tickEnabledEl = document.getElementById('tickEnabled');
    const dotsEnabledEl = document.getElementById('dotsEnabled');
    const tickVolumeEl = document.getElementById('tickVolume');
    const tickVolumeLabel = document.getElementById('tickVolumeLabel');
    const spinDurationEl = document.getElementById('spinDuration');
    const baseTurnsEl = document.getElementById('baseTurns');
    const wobbleEl = document.getElementById('wobble');
    const wobbleLabel = document.getElementById('wobbleLabel');

    const pointerWrap = document.getElementById('pointerWrap');

    const W = canvas.width, H = canvas.height;
    const cx = W / 2, cy = H / 2;
    const radius = Math.min(W, H) * 0.45;
    const labelRadius = radius * 0.7;

    const defaultItems = ["Pregunta", "10 Sentadillas", "Pregunta", "Baile", "Pregunta","Haz equilibrio","Pregunta","Baile"];    
    let palette = ["#FFAE42","#3BB2BE","#BA4F90","#ED4D6D","#FFAE42","#4DC4CA","#BA4F90","#ED4D6D","#FFAE42","#4DC4CA"];

    const state = {
      items: [],
      angle: 0,            // radianes actuales
      spinning: false,
      lastWinIndex: null,
      tickEnabled: true,
      dotsEnabled: true,
      tickVolume: 0.35,
      spinDuration: 5200,
      baseTurns: 7,
      wobble: 0.55
    };

    const pointerState = { angle: 0, vel: 0 };

    // =======================
    // Utilidades
    // =======================
    function clamp(v,a,b){ return Math.min(b, Math.max(a,v)); }
    function shuffle(arr){
      const a = [...arr];
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }
    function parseItems(){
      const raw = itemsBox.value.split('\n').map(s=>s.trim()).filter(Boolean);
      state.items = raw.length >= 2 ? raw : [...defaultItems];
    }
    function normalizeAngle(a){
      const tau = Math.PI*2;
      a = a % tau;
      if(a < 0) a += tau;
      return a;
    }

    // =======================
    // Audio tic
    // =======================
    let audioCtx = null;
    function ensureAudio(){
      if(!audioCtx){
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
      if(audioCtx.state === "suspended") audioCtx.resume().catch(()=>{});
    }
    function playTick(strength=1){
      if(!state.tickEnabled) return;
      ensureAudio();
      if(!audioCtx) return;
      const t = audioCtx.currentTime;
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      const vol = state.tickVolume * clamp(strength, 0.3, 1.3);
      osc.type = "square";
      osc.frequency.setValueAtTime(900, t);
      osc.frequency.exponentialRampToValueAtTime(240, t+0.018);
      gain.gain.setValueAtTime(0.0001, t);
      gain.gain.exponentialRampToValueAtTime(vol, t+0.002);
      gain.gain.exponentialRampToValueAtTime(0.0001, t+0.045);
      osc.connect(gain);
      gain.connect(audioCtx.destination);
      osc.start(t);
      osc.stop(t+0.05);
    }

    // =======================
    // Dibujo ruleta
    // =======================
    function drawWheel(){
      ctx.clearRect(0,0,W,H);

      ctx.beginPath();
      ctx.arc(cx, cy, radius+10, 0, Math.PI*2);
      ctx.fillStyle = "rgba(255,255,255,0.03)";
      ctx.fill();

      const n = state.items.length;
      const slice = (Math.PI*2)/n;

      for(let i=0;i<n;i++){
        const start = state.angle + i*slice;
        const end = start + slice;

        ctx.beginPath();
        ctx.moveTo(cx,cy);
        ctx.arc(cx, cy, radius, start, end);
        ctx.closePath();
        ctx.fillStyle = palette[i % palette.length];
        ctx.fill();

        ctx.strokeStyle = "rgba(255,255,255,0.16)";
        ctx.lineWidth = 2;
        ctx.stroke();

        const mid = (start + end)/2;
        ctx.save();
        ctx.translate(cx, cy);
        ctx.rotate(mid);
        ctx.textAlign = "right";
        ctx.textBaseline = "middle";
        ctx.fillStyle = "rgba(255,255,255,0.94)";
        ctx.shadowColor = "rgba(0,0,0,0.45)";
        ctx.shadowBlur = 8;
        ctx.font = "900 30px 'Segoe UI', system-ui";
        const label = state.items[i].length > 18 ? state.items[i].slice(0,18) + "…" : state.items[i];
        ctx.fillText(label, labelRadius, 0);
        ctx.restore();
      }

      if(state.dotsEnabled){
        ctx.save();
        ctx.translate(cx, cy);
        const dotR = 7;
        const ringR = radius * 0.97;
        for(let i=0;i<n;i++){
          const a = state.angle + i*slice;
          const x = Math.cos(a) * ringR;
          const y = Math.sin(a) * ringR;
          ctx.beginPath();
          ctx.arc(x, y, dotR, 0, Math.PI*2);
          ctx.fillStyle = "white";
          ctx.fill();
          ctx.strokeStyle = "rgba(0,0,0,0.28)";
          ctx.lineWidth = 2;
          ctx.stroke();
        }
        ctx.restore();
      }

      ctx.beginPath();
      ctx.arc(cx, cy, radius, 0, Math.PI*2);
      ctx.strokeStyle = "rgba(0,0,0,0.38)";
      ctx.lineWidth = 8;
      ctx.stroke();

      if(state.lastWinIndex !== null){
        const mid = state.angle + (state.lastWinIndex + 0.5) * slice;
        ctx.save();
        ctx.translate(cx,cy);
        ctx.rotate(mid);
        ctx.beginPath();
        ctx.arc(radius*0.84, 0, 13, 0, Math.PI*2);
        ctx.fillStyle = "rgba(255,255,255,0.94)";
        ctx.fill();
        ctx.restore();
      }
    }

    function indexAtPointer(angle){
      const n = state.items.length;
      const slice = (Math.PI*2)/n;
      const pointerAngle = -Math.PI/2; // arriba
      let a = (pointerAngle - angle) % (Math.PI*2);
      if(a < 0) a += Math.PI*2;
      return Math.floor(a / slice);
    }

    // =======================
    // Puntero wobble + tic
    // =======================
    let lastTickIndex = null;
    function stepPointer(deltaAngle, speed01){
      // Sentido horario => deltaAngle negativo; usamos signo para inclinacion
      const dir = Math.sign(deltaAngle) || -1;
      pointerState.vel += (-pointerState.angle) * (0.22 + state.wobble*0.4);
      pointerState.vel *= 0.86;
      pointerState.angle += pointerState.vel;
      const follow = dir * (4 * speed01 * state.wobble);
      const totalDeg = clamp(pointerState.angle + follow, -32, 32);
      pointerWrap.style.transform = `translateX(-50%) rotate(${totalDeg}deg)`;
    }
    function hitPeg(dir, speed01){
      const impulse = -dir * (6 + speed01 * 24) * (0.35 + state.wobble*0.65);
      pointerState.vel += impulse;
      playTick(0.8 + speed01*0.4);
    }
    function maybeTick(deltaAngle, speed01){
      const idx = indexAtPointer(state.angle);
      if(lastTickIndex === null) lastTickIndex = idx;
      if(idx !== lastTickIndex){
        hitPeg(Math.sign(deltaAngle) || -1, speed01);
        lastTickIndex = idx;
      }
    }
    function resetPointer(){
      pointerState.angle = 0;
      pointerState.vel = 0;
      pointerWrap.style.transition = "transform 180ms ease";
      pointerWrap.style.transform = "translateX(-50%) rotate(0deg)";
      setTimeout(()=> pointerWrap.style.transition = "", 220);
    }

    // =======================
    // Giro (siempre horario)
    // =======================
    function spin(){
      if(state.spinning) return;
      parseItems();
      drawWheel();

      // mantener el ángulo en rango para asegurar giro horario
      state.angle = normalizeAngle(state.angle);

      const n = state.items.length;
      const slice = (Math.PI*2)/n;

      const winIndex = Math.floor(Math.random() * n);
      const pointerAngle = -Math.PI/2;
      const targetMid = (winIndex + 0.5) * slice;
      const baseTurns = clamp(state.baseTurns + Math.floor(Math.random()*3), 2, 30);

      // sentido horario => delta negativo
      const desiredFinal = pointerAngle - targetMid - baseTurns * Math.PI*2;
      const startAngle = state.angle;
      const delta = desiredFinal - startAngle; // negativo

      const duration = clamp(state.spinDuration + Math.floor(Math.random()*450), 1200, 15000);
      const t0 = performance.now();

      state.spinning = true;
      spinBtn.disabled = true;
      lastTickIndex = null;

      function easeOutQuint(t){ return 1 - Math.pow(1 - t, 5); }

      function frame(now){
        const t = Math.min(1, (now - t0) / duration);
        const e = easeOutQuint(t);

        const prevAngle = state.angle;
        state.angle = startAngle + delta * e; // sigue siendo horario
        const dA = state.angle - prevAngle;
        const speed01 = clamp(Math.abs(dA) / 0.2, 0, 1);

        stepPointer(dA, speed01);
        maybeTick(dA, speed01);
        drawWheel();

        if(t < 1){
          requestAnimationFrame(frame);
        } else {
          state.spinning = false;
          spinBtn.disabled = false;
          resetPointer();
          state.lastWinIndex = indexAtPointer(state.angle);
          resultEl.textContent = `Resultado: ${state.items[state.lastWinIndex]}`;
          drawWheel();
        }
      }
      requestAnimationFrame(frame);
    }

    // =======================
    // Drawer y settings
    // =======================
    function openDrawer(){ document.body.classList.add('open'); }
    function closeDrawer(){ document.body.classList.remove('open'); }
    settingsBtn.addEventListener('click', openDrawer);
    overlay.addEventListener('click', closeDrawer);
    closeDrawerBtn.addEventListener('click', closeDrawer);
    closeDrawerBtn2.addEventListener('click', closeDrawer);

    function syncSettingsUI(){
      itemsBox.value = state.items.join("\n");
      tickEnabledEl.checked = state.tickEnabled;
      dotsEnabledEl.checked = state.dotsEnabled;
      tickVolumeEl.value = String(state.tickVolume);
      tickVolumeLabel.textContent = `Volumen: ${Math.round(state.tickVolume*100)}%`;
      spinDurationEl.value = String(state.spinDuration);
      baseTurnsEl.value = String(state.baseTurns);
      wobbleEl.value = String(state.wobble);
      wobbleLabel.textContent = `Intensidad: ${Math.round(state.wobble*100)}%`;
    }

    function applySettings(){
      parseItems();
      state.tickEnabled = !!tickEnabledEl.checked;
      state.dotsEnabled = !!dotsEnabledEl.checked;
      state.tickVolume = clamp(parseFloat(tickVolumeEl.value || "0.35"), 0, 1);
      state.spinDuration = clamp(parseInt(spinDurationEl.value || "5200", 10), 1200, 15000);
      state.baseTurns = clamp(parseInt(baseTurnsEl.value || "7", 10), 2, 30);
      state.wobble = clamp(parseFloat(wobbleEl.value || "0.55"), 0, 1);

      tickVolumeLabel.textContent = `Volumen: ${Math.round(state.tickVolume*100)}%`;
      wobbleLabel.textContent = `Intensidad: ${Math.round(state.wobble*100)}%`;

      state.lastWinIndex = null;
      drawWheel();
      resetPointer();
    }

    applyBtn.addEventListener('click', () => {
      applySettings();
      closeDrawer();
    });

    tickVolumeEl.addEventListener('input', () => {
      tickVolumeLabel.textContent = `Volumen: ${Math.round(parseFloat(tickVolumeEl.value)*100)}%`;
    });
    wobbleEl.addEventListener('input', () => {
      wobbleLabel.textContent = `Intensidad: ${Math.round(parseFloat(wobbleEl.value)*100)}%`;
    });

    shufflePaletteBtn.addEventListener('click', () => {
      palette = shuffle(palette);
      drawWheel();
    });

    // =======================
    // Botón girar
    // =======================
    spinBtn.addEventListener('click', () => {
      ensureAudio();
      spin();
    });

    // =======================
    // Init
    // =======================
    (function init(){
      state.items = [...defaultItems];
      syncSettingsUI();
      drawWheel();
      resultEl.textContent = "Resultado: —";
    })();
  </script>
</body>
</html>
